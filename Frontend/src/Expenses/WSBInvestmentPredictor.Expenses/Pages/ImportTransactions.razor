@page "/import"
@using WSBInvestmentPredictor.Expenses.Services
@using WSBInvestmentPredictor.Expenses.Shared.Models
@using Microsoft.Extensions.Localization
@using WSBInvestmentPredictor.Frontend.Shared
@inject IStringLocalizer<SharedResource> Loc

<PageTitle>@Loc["ImportBankTransactions"]</PageTitle>

<h1>@Loc["ImportBankTransactions"]</h1>
<p>@Loc["UploadBankStatementDescription"]</p>

<!-- File upload control -->
<div class="row mb-3">
    <div class="col">
        <InputFile OnChange="@LoadFiles" class="form-control" accept=".csv" />
    </div>
</div>

<!-- Loading indicator -->
@if (isLoading)
{
    <div class="alert alert-info">
        @Loc["LoadingFile"]
    </div>
}

<!-- Error message display -->
@if (errorMessage != null)
{
    <div class="alert alert-danger">
        @errorMessage
    </div>
}

<!-- Transactions preview and actions -->
@if (transactions != null && transactions.Any())
{
    <!-- Success message -->
    <div class="alert alert-success">
        @Loc["SuccessfullyImported"] @transactions.Count @Loc["Transactions"]
    </div>

    <!-- Action buttons -->
    <div class="mb-3">
        <button class="btn btn-primary me-2" @onclick="SaveTransactions" disabled="@isSaving">
            @if (isSaving)
            {
                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                <span class="ms-1">@Loc["Saving"]</span>
            }
            else
            {
                <span>@Loc["SaveTransactions"]</span>
            }
        </button>
        <button class="btn btn-secondary" @onclick="ViewTransactions">@Loc["ViewAllTransactions"]</button>
    </div>

    <!-- Transactions preview table -->
    <div class="table-responsive">
        <RadzenDataGrid Data="@transactions" TItem="BankTransaction" Pageable="true" PageSize="20" Class="import-table rz-shadow-1" Responsive="true" AllowSorting="true" AllowColumnResize="true">
            <Columns>
                <RadzenDataGridColumn TItem="BankTransaction" Property="TransactionDate" Title="@Loc["TransactionDate"]" FormatString="{0:yyyy-MM-dd}" />
                <RadzenDataGridColumn TItem="BankTransaction" Property="BookingDate" Title="@Loc["BookingDate"]">
                    <Template Context="t">@(t.BookingDate?.ToShortDateString() ?? "-")</Template>
                </RadzenDataGridColumn>
                <RadzenDataGridColumn TItem="BankTransaction" Property="Counterparty" Title="@Loc["Counterparty"]" />
                <RadzenDataGridColumn TItem="BankTransaction" Property="Title" Title="@Loc["Title"]" />
                <RadzenDataGridColumn TItem="BankTransaction" Property="Amount" Title="@Loc["Amount"]">
                    <Template Context="t">@t.Amount.ToString("N2")</Template>
                </RadzenDataGridColumn>
                <RadzenDataGridColumn TItem="BankTransaction" Property="Currency" Title="@Loc["Currency"]" />
                <RadzenDataGridColumn TItem="BankTransaction" Property="Account" Title="@Loc["Account"]" />
                <RadzenDataGridColumn TItem="BankTransaction" Property="BalanceAfterTransaction" Title="@Loc["Balance"]">
                    <Template Context="t">@(t.BalanceAfterTransaction?.ToString("N2") ?? "-") @t.BalanceCurrency</Template>
                </RadzenDataGridColumn>
            </Columns>
        </RadzenDataGrid>
    </div>
}

<style>
.import-table {
    background-color: var(--rz-header-background-color);
    color: var(--rz-text-color);
    border-radius: 8px;
    overflow: hidden;
    box-shadow: var(--rz-shadow-1);
    transition: background 0.2s, color 0.2s;
}
.import-table th, .import-table td {
    border-color: var(--rz-border);
}
.import-table tbody tr:hover {
    background-color: var(--rz-table-row-hover-bg);
}
</style> 