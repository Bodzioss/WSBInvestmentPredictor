@page "/import"
@using WSBInvestmentPredictor.Expenses.Services
@using WSBInvestmentPredictor.Expenses.Shared.Models
@using Microsoft.Extensions.Localization
@using WSBInvestmentPredictor.Frontend.Shared
@inject IStringLocalizer<SharedResource> Loc

<PageTitle>@Loc["ImportBankTransactions"]</PageTitle>

<h1>@Loc["ImportBankTransactions"]</h1>
<p>@Loc["UploadBankStatementDescription"]</p>

<!-- File upload control -->
<div class="row mb-3">
    <div class="col">
        <InputFile OnChange="@LoadFiles" class="form-control" accept=".csv" />
    </div>
</div>

<!-- Loading indicator -->
@if (isLoading)
{
    <div class="alert alert-info">
        @Loc["LoadingFile"]
    </div>
}

<!-- Error message display -->
@if (errorMessage != null)
{
    <div class="alert alert-danger">
        @errorMessage
    </div>
}

<!-- Transactions preview and actions -->
@if (transactions != null && transactions.Any())
{
    <!-- Success message -->
    <div class="alert alert-success">
        @Loc["SuccessfullyImported"] @transactions.Count @Loc["Transactions"]
    </div>

    <!-- Transactions preview table -->
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>@Loc["TransactionDate"]</th>
                    <th>@Loc["BookingDate"]</th>
                    <th>@Loc["Counterparty"]</th>
                    <th>@Loc["Title"]</th>
                    <th>@Loc["Amount"]</th>
                    <th>@Loc["Currency"]</th>
                    <th>@Loc["Account"]</th>
                    <th>@Loc["Balance"]</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var transaction in transactions)
                {
                    <tr>
                        <td>@transaction.TransactionDate.ToShortDateString()</td>
                        <td>@(transaction.BookingDate?.ToShortDateString() ?? "-")</td>
                        <td>@transaction.Counterparty</td>
                        <td>@transaction.Title</td>
                        <td>@transaction.Amount.ToString("N2")</td>
                        <td>@transaction.Currency</td>
                        <td>@transaction.Account</td>
                        <td>@(transaction.BalanceAfterTransaction?.ToString("N2") ?? "-") @transaction.BalanceCurrency</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Action buttons -->
    <div class="mt-3">
        <button class="btn btn-primary" @onclick="SaveTransactions" disabled="@isSaving">
            @if (isSaving)
            {
                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                <span class="ms-1">@Loc["Saving"]</span>
            }
            else
            {
                <span>@Loc["SaveTransactions"]</span>
            }
        </button>
        <button class="btn btn-secondary" @onclick="ViewTransactions">@Loc["ViewAllTransactions"]</button>
    </div>
} 