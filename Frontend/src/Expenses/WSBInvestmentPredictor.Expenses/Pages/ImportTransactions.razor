@page "/import"
@using WSBInvestmentPredictor.Expenses.Services
@using WSBInvestmentPredictor.Expenses.Shared.Models

<PageTitle>Import Transactions</PageTitle>

<h1>Import Bank Transactions</h1>

<div class="row mb-3">
    <div class="col">
        <InputFile OnChange="@LoadFiles" class="form-control" />
    </div>
</div>

@if (isLoading)
{
    <div class="alert alert-info">
        Loading file...
    </div>
}

@if (errorMessage != null)
{
    <div class="alert alert-danger">
        @errorMessage
    </div>
}

@if (transactions != null && transactions.Any())
{
    <div class="alert alert-success">
        Successfully imported @transactions.Count transactions
    </div>

    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Transaction Date</th>
                    <th>Booking Date</th>
                    <th>Counterparty</th>
                    <th>Title</th>
                    <th>Amount</th>
                    <th>Currency</th>
                    <th>Account</th>
                    <th>Balance</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var transaction in transactions)
                {
                    <tr>
                        <td>@transaction.TransactionDate.ToShortDateString()</td>
                        <td>@(transaction.BookingDate?.ToShortDateString() ?? "-")</td>
                        <td>@transaction.Counterparty</td>
                        <td>@transaction.Title</td>
                        <td>@transaction.Amount.ToString("N2")</td>
                        <td>@transaction.Currency</td>
                        <td>@transaction.Account</td>
                        <td>@(transaction.BalanceAfterTransaction?.ToString("N2") ?? "-") @transaction.BalanceCurrency</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="mt-3">
        <button class="btn btn-primary" @onclick="SaveTransactions" disabled="@isSaving">
            @if (isSaving)
            {
                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                <span class="ms-1">Saving...</span>
            }
            else
            {
                <span>Save Transactions</span>
            }
        </button>
        <button class="btn btn-secondary" @onclick="ViewTransactions">View All Transactions</button>
    </div>
} 